import{j as e}from"./ui-core-DSsgHKQi.js";import{R as F,r as C,u as Fe}from"./react-core-C2Lho-Ro.js";import{b as Ae,u as Pe,c as M,d as le}from"./form-DucUJAz-.js";import{c as N,B as h,a as Te,J as b,b as T}from"./index-CwoeutiG.js";import{I as j}from"./input-BL695Knw.js";import{T as ke,a as qe,b as Ee,c as v,d as Re,e as w}from"./table-KyucOfjK.js";import{E as Ie,S as O,a as V,b as z,c as $,d as k}from"./enhanced-page-header-Cial-IQU.js";import{D as B,a as H,b as W,c as Q,d as K,e as U}from"./dialog-KvZ9DuRC.js";import{F as ne,a as i,b as o,c,d,e as m}from"./form-Bxhwt7Ly.js";import{T as te,a as Ge,b as ie,c as oe}from"./tabs-BdzKwmyA.js";import{C as ce,a as Le,b as Me,c as Oe,d as Ve,e as ze}from"./card-D01js5Yw.js";import{m as A}from"./animation-CC1ogdXw.js";import{B as de}from"./badge-D22ac54H.js";import{l as $e,P as je,M as ue,g as Be,m as He,n as We,o as me,p as Qe,q as Ke,R as Ue,U as he,L as J}from"./utils-D1Dv2Yo8.js";import{L as Je,E as xe}from"./loading-state-CgPl31pa.js";import"./auth-D43A8yQe.js";import"./label-Cgr4Vjb0.js";const pe=F.forwardRef(({className:l,animate:u=!0,delay:t=0,motionProps:_,...y},p)=>u?e.jsx(A.div,{ref:p,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:t*.1},..._,children:e.jsx(ce,{className:N("border-opacity-40 bg-opacity-60 backdrop-blur-sm shadow-md",l),...y})}):e.jsx("div",{ref:p,children:e.jsx(ce,{className:N("border-opacity-40 bg-opacity-60 backdrop-blur-sm shadow-md",l),...y})}));pe.displayName="GlassCard";const Xe=F.forwardRef(({className:l,...u},t)=>e.jsx(Le,{ref:t,className:N("px-5 py-4",l),...u}));Xe.displayName="GlassCardHeader";const Ye=F.forwardRef(({className:l,...u},t)=>e.jsx(Me,{ref:t,className:N("text-lg",l),...u}));Ye.displayName="GlassCardTitle";const Ze=F.forwardRef(({className:l,...u},t)=>e.jsx(Oe,{ref:t,className:N("text-sm",l),...u}));Ze.displayName="GlassCardDescription";const ge=F.forwardRef(({className:l,...u},t)=>e.jsx(Ve,{ref:t,className:N("px-5 py-4",l),...u}));ge.displayName="GlassCardContent";const fe=F.forwardRef(({className:l,...u},t)=>e.jsx(ze,{ref:t,className:N("px-5 py-4 flex justify-between",l),...u}));fe.displayName="GlassCardFooter";function es({student:l,onViewDetails:u,onEdit:t,onDelete:_,onCall:y,onWhatsApp:p,index:q=0}){const S=r=>{switch(r){case"Paid":return"bg-green-500 hover:bg-green-600";case"Partial":return"bg-amber-500 hover:bg-amber-600";default:return"bg-red-500 hover:bg-red-600"}},E=r=>{r.stopPropagation(),y&&l.contact_number&&y(l.contact_number)},D=r=>{r.stopPropagation(),p&&l.contact_number&&p(l.contact_number)};return e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:q*.05},whileHover:{y:-4},className:"h-full",children:e.jsxs(pe,{className:"h-full transition-all duration-200 hover:shadow-lg cursor-pointer flex flex-col",animate:!1,onClick:()=>u(l.id),children:[e.jsxs(ge,{className:"p-5 flex-grow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(de,{className:"px-2 py-0.5 text-xs",children:["Class ",l.class]}),e.jsx(de,{className:N("px-2 py-0.5 text-xs text-white",S(l.fee_status||"Pending")),children:l.fee_status||"Pending"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:l.full_name}),e.jsxs("p",{className:"text-muted-foreground text-sm flex items-center",children:[e.jsx($e,{className:"h-3.5 w-3.5 mr-1.5 text-muted-foreground"}),new Date(l.date_of_birth).toLocaleDateString()]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Roll Number"}),e.jsx("p",{className:"font-medium",children:l.roll_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Guardian"}),e.jsx("p",{className:"font-medium line-clamp-1",children:l.guardian_name})]})]}),e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[e.jsxs(h,{variant:"ghost",size:"sm",className:"flex-1 flex items-center justify-center gap-1 h-8 text-blue-500 hover:text-blue-600 hover:bg-blue-50",onClick:E,children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs",children:"Call"})]}),e.jsxs(h,{variant:"ghost",size:"sm",className:"flex-1 flex items-center justify-center gap-1 h-8 text-green-500 hover:text-green-600 hover:bg-green-50",onClick:D,children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs",children:"WhatsApp"})]})]})]}),e.jsxs(fe,{className:"border-t",children:[e.jsxs(h,{variant:"ghost",size:"sm",className:"w-full",onClick:r=>{r.stopPropagation(),u(l.id)},children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Details"]}),e.jsxs("div",{className:"flex gap-1",children:[t&&e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:r=>{r.stopPropagation(),t(l)},children:e.jsx(He,{className:"h-4 w-4"})}),_&&e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:r=>{r.stopPropagation(),_(l)},children:e.jsx(We,{className:"h-4 w-4"})})]})]})]})})}function fs(){const[l,u]=C.useState(""),[t,_]=C.useState("all"),[y,p]=C.useState(!1),[q,S]=C.useState(!1),[E,D]=C.useState(!1),[r,X]=C.useState(null),[Y,be]=C.useState("grid"),Ne=Fe(),P=Ae();Te();const{data:ye=[],isLoading:Ce,isError:ve}=Pe({queryKey:["students"],queryFn:T.getStudents}),R=ye.filter(s=>{const x=s.full_name.toLowerCase().includes(l.toLowerCase())||s.guardian_name.toLowerCase().includes(l.toLowerCase())||s.roll_number.toString().includes(l),a=t==="all"||s.class===parseInt(t);return x&&a}),Z=s=>{window.open(`tel:${s}`,"_blank"),b.success(`Calling ${s}`)},ee=s=>{window.open(`https://wa.me/${s.replace(/\D/g,"")}`,"_blank"),b.success(`Opening WhatsApp for ${s}`)},I=M({mutationFn:T.createStudent,onSuccess:()=>{P.invalidateQueries({queryKey:["students"]}),p(!1),b.success("Student added successfully")},onError:s=>{b.error(s.message||"Failed to add student")}}),G=M({mutationFn:({id:s,data:x})=>T.updateStudent(s,x),onSuccess:()=>{P.invalidateQueries({queryKey:["students"]}),S(!1),b.success("Student updated successfully")},onError:s=>{b.error(s.message||"Failed to update student")}}),L=M({mutationFn:T.deleteStudent,onSuccess:()=>{P.invalidateQueries({queryKey:["students"]}),D(!1),b.success("Student deleted successfully")},onError:s=>{b.error(s.message||"Failed to delete student")}}),se=s=>{Ne(`/students/${s}`)},ae=s=>{X(s),S(!0)},re=s=>{X(s),D(!0)},we=(s="")=>{const x=s.split(" ");return x.length>=2?{fatherName:x[0],motherName:x.slice(1).join(" ")}:{fatherName:s,motherName:""}},_e=()=>{const s=le({defaultValues:{full_name:"",class:2,roll_number:"",date_of_birth:"",address:"",father_name:"",mother_name:"",contact_number:"",whatsapp_number:""}}),x=a=>{const g=`${a.father_name} ${a.mother_name}`.trim();I.mutate({...a,guardian_name:g,class:parseInt(a.class.toString()),roll_number:parseInt(a.roll_number)})};return e.jsx(ne,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(x),className:"space-y-4",children:[e.jsx(i,{control:s.control,name:"full_name",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Full Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Full name",...a,required:!0})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:s.control,name:"class",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Class"}),e.jsxs(O,{onValueChange:g=>a.onChange(parseInt(g)),defaultValue:a.value.toString(),value:a.value.toString(),children:[e.jsx(d,{children:e.jsx(V,{children:e.jsx(z,{placeholder:"Select class"})})}),e.jsx($,{children:Array.from({length:9},(g,n)=>n+2).map(g=>e.jsxs(k,{value:g.toString(),children:["Class ",g]},g))})]}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"roll_number",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Roll Number"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"Roll number",...a,min:"1",required:!0})}),e.jsx(m,{})]})})]}),e.jsx(i,{control:s.control,name:"date_of_birth",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Date of Birth"}),e.jsx(d,{children:e.jsx(j,{type:"date",...a,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"address",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Address"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Address",...a})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:s.control,name:"father_name",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Father's Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Father's name",...a,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"mother_name",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Mother's Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Mother's name",...a})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:s.control,name:"contact_number",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Contact Number"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Contact number",...a,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:s.control,name:"whatsapp_number",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"WhatsApp Number"}),e.jsx(d,{children:e.jsx(j,{placeholder:"WhatsApp number (optional)",...a})}),e.jsx(m,{})]})})]}),e.jsxs(U,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(h,{type:"submit",disabled:I.isPending,children:I.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):"Add Student"})]})]})})},Se=()=>{const{fatherName:s,motherName:x}=we(r==null?void 0:r.guardian_name),a=le({defaultValues:{full_name:(r==null?void 0:r.full_name)||"",class:(r==null?void 0:r.class)||2,roll_number:(r==null?void 0:r.roll_number.toString())||"",date_of_birth:r!=null&&r.date_of_birth?new Date(r.date_of_birth).toISOString().split("T")[0]:"",address:(r==null?void 0:r.address)||"",father_name:s||"",mother_name:x||"",contact_number:(r==null?void 0:r.contact_number)||"",whatsapp_number:(r==null?void 0:r.contact_number)||""}}),g=n=>{if(!r)return;const f=`${n.father_name} ${n.mother_name}`.trim();G.mutate({id:r.id,data:{...n,guardian_name:f,class:parseInt(n.class.toString()),roll_number:parseInt(n.roll_number)}})};return e.jsx(ne,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(g),className:"space-y-4",children:[e.jsx(i,{control:a.control,name:"full_name",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Full Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Full name",...n,required:!0})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:a.control,name:"class",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Class"}),e.jsxs(O,{onValueChange:f=>n.onChange(parseInt(f)),value:n.value.toString(),children:[e.jsx(d,{children:e.jsx(V,{children:e.jsx(z,{placeholder:"Select class"})})}),e.jsx($,{children:Array.from({length:9},(f,De)=>De+2).map(f=>e.jsxs(k,{value:f.toString(),children:["Class ",f]},f))})]}),e.jsx(m,{})]})}),e.jsx(i,{control:a.control,name:"roll_number",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Roll Number"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"Roll number",...n,min:"1",required:!0})}),e.jsx(m,{})]})})]}),e.jsx(i,{control:a.control,name:"date_of_birth",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Date of Birth"}),e.jsx(d,{children:e.jsx(j,{type:"date",...n,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:a.control,name:"address",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Address"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Address",...n})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:a.control,name:"father_name",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Father's Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Father's name",...n,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:a.control,name:"mother_name",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Mother's Name"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Mother's name",...n})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:a.control,name:"contact_number",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"Contact Number"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Contact number",...n,required:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:a.control,name:"whatsapp_number",render:({field:n})=>e.jsxs(o,{children:[e.jsx(c,{children:"WhatsApp Number"}),e.jsx(d,{children:e.jsx(j,{placeholder:"WhatsApp number (optional)",...n})}),e.jsx(m,{})]})})]}),e.jsxs(U,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(h,{type:"submit",disabled:G.isPending,children:G.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Student"})]})]})})};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ie,{title:"Students"}),e.jsxs(h,{onClick:()=>p(!0),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Add Student"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Search by name, guardian or roll number...",value:l,onChange:s=>u(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{value:t,onValueChange:_,children:[e.jsx(V,{className:"w-full sm:w-[180px]",children:e.jsx(z,{placeholder:"Filter by class"})}),e.jsxs($,{children:[e.jsx(k,{value:"all",children:"All Classes"}),Array.from({length:9},(s,x)=>x+2).map(s=>e.jsxs(k,{value:s.toString(),children:["Class ",s]},s))]})]}),e.jsx(te,{value:Y,onValueChange:s=>be(s),children:e.jsxs(Ge,{className:"grid w-20 grid-cols-2",children:[e.jsx(ie,{value:"grid",className:"p-2",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(ie,{value:"table",className:"p-2",children:e.jsx(Ue,{className:"h-4 w-4"})})]})})]})]}),Ce?e.jsx(Je,{}):ve?e.jsx(xe,{icon:e.jsx(he,{className:"h-10 w-10 text-muted-foreground"}),title:"Error loading students",description:"There was an error loading the student data. Please try again later.",action:e.jsx(h,{variant:"outline",onClick:()=>P.invalidateQueries({queryKey:["students"]}),children:"Try Again"})}):R.length===0?e.jsx(xe,{icon:e.jsx(he,{className:"h-10 w-10 text-muted-foreground"}),title:"No students found",description:!l&&t==="all"?"Add your first student by clicking the 'Add Student' button.":"Try adjusting your search or filters to find what you're looking for.",action:e.jsxs(h,{onClick:()=>p(!0),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Add Student"]})}):e.jsxs(te,{value:Y,className:"mt-2",children:[e.jsx(oe,{value:"grid",className:"mt-0",children:e.jsx(A.div,{layout:!0,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:R.map((s,x)=>e.jsx(es,{student:s,index:x,onViewDetails:se,onEdit:ae,onDelete:re,onCall:Z,onWhatsApp:ee},s.id))})}),e.jsx(oe,{value:"table",className:"mt-0",children:e.jsx("div",{className:"rounded-md border overflow-hidden backdrop-blur-sm bg-card/60",children:e.jsxs(ke,{children:[e.jsx(qe,{children:e.jsxs(Ee,{children:[e.jsx(v,{className:"w-[80px]",children:"Roll No"}),e.jsx(v,{children:"Name"}),e.jsx(v,{className:"hidden md:table-cell",children:"Class"}),e.jsx(v,{className:"hidden md:table-cell",children:"Date of Birth"}),e.jsx(v,{className:"hidden lg:table-cell",children:"Guardian"}),e.jsx(v,{className:"hidden lg:table-cell",children:"Contact"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(Re,{children:R.map((s,x)=>e.jsxs(A.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:x*.05},onClick:()=>se(s.id),className:"cursor-pointer hover:bg-muted/80",children:[e.jsx(w,{children:s.roll_number}),e.jsx(w,{className:"font-medium",children:s.full_name}),e.jsxs(w,{className:"hidden md:table-cell",children:["Class ",s.class]}),e.jsx(w,{className:"hidden md:table-cell",children:new Date(s.date_of_birth).toLocaleDateString()}),e.jsx(w,{className:"hidden lg:table-cell",children:s.guardian_name}),e.jsx(w,{className:"hidden lg:table-cell",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7 text-blue-500",onClick:a=>{a.stopPropagation(),Z(s.contact_number)},children:e.jsx(je,{className:"h-3.5 w-3.5"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7 text-green-500",onClick:a=>{a.stopPropagation(),ee(s.contact_number)},children:e.jsx(ue,{className:"h-3.5 w-3.5"})})]})}),e.jsx(w,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),ae(s)},children:"Edit"}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-red-500",onClick:a=>{a.stopPropagation(),re(s)},children:"Delete"})]})})]},s.id))})]})})})]})]}),e.jsx(B,{open:y,onOpenChange:p,children:e.jsxs(H,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Add New Student"}),e.jsx(K,{children:"Enter the details of the new student below."})]}),e.jsx(_e,{})]})}),e.jsx(B,{open:q,onOpenChange:S,children:e.jsxs(H,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Edit Student"}),e.jsx(K,{children:"Update the details of the student below."})]}),r&&e.jsx(Se,{})]})}),e.jsx(B,{open:E,onOpenChange:D,children:e.jsxs(H,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Confirm Deletion"}),e.jsxs(K,{children:["Are you sure you want to delete ",r==null?void 0:r.full_name,"? This action cannot be undone."]})]}),e.jsxs(U,{children:[e.jsx(h,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(h,{variant:"destructive",disabled:L.isPending,onClick:()=>{r&&L.mutate(r.id)},children:L.isPending?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{fs as default};
