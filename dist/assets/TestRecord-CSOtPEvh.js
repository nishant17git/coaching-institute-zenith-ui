import{j as e}from"./ui-core-DSsgHKQi.js";import{r as h}from"./react-core-C2Lho-Ro.js";import{u as M}from"./form-DucUJAz-.js";import{a as re,B,s as le}from"./index-CwoeutiG.js";import{C as i,a as u,b as j,d as m,c as R}from"./card-D01js5Yw.js";import{T as ce,a as ne,b as P,c as F}from"./tabs-BdzKwmyA.js";import{I as ie}from"./input-BL695Knw.js";import{T as de,a as oe,b as L,c as x,d as me,e as d}from"./table-KyucOfjK.js";import{E as xe,S as E,a as $,b as G,c as I,d as g}from"./enhanced-page-header-Cial-IQU.js";import{B as Q}from"./badge-D22ac54H.js";import{L as he,o as ue,D as je,p as fe,x as K}from"./utils-D1Dv2Yo8.js";import{m as k,A as q}from"./animation-CC1ogdXw.js";import{R as H,P as ge,b as pe,c as V,T as z,B as Ne,C as ve,X as be,Y as ye,a as _e}from"./data-viz-DCuZCixt.js";import{f as O}from"./format-BEMO4FpZ.js";import"./auth-D43A8yQe.js";function Ge(){const[S,U]=h.useState(""),[p,J]=h.useState("all"),[N,X]=h.useState("all"),[T,Y]=h.useState("date"),[v,w]=h.useState("desc"),W=re(),{data:l=[],isLoading:Z}=M({queryKey:["test_records_mock"],queryFn:async()=>{const s=localStorage.getItem("mockTestRecords");if(s)return JSON.parse(s);const a=[{id:"1",student_id:"1",subject:"Mathematics",test_date:"2024-04-15",test_name:"Algebra Quiz",marks:42,total_marks:50},{id:"2",student_id:"2",subject:"Physics",test_date:"2024-04-10",test_name:"Mechanics Test",marks:35,total_marks:40},{id:"3",student_id:"3",subject:"Chemistry",test_date:"2024-04-05",test_name:"Periodic Table Quiz",marks:28,total_marks:30},{id:"4",student_id:"1",subject:"English",test_date:"2024-04-01",test_name:"Grammar Test",marks:38,total_marks:50},{id:"5",student_id:"4",subject:"Mathematics",test_date:"2024-04-12",test_name:"Geometry Quiz",marks:18,total_marks:30}];return localStorage.setItem("mockTestRecords",JSON.stringify(a)),a}}),{data:b=[],isLoading:ee}=M({queryKey:["students"],queryFn:async()=>{const{data:s,error:a}=await le.from("students").select("*");if(a)throw a;return s||[]}}),y=Array.from(new Set(l.map(s=>s.subject))),se=l.length,ae=l.length>0?Math.round(l.reduce((s,a)=>s+a.marks,0)/l.length):0,n=[{name:"A (90-100%)",value:0,color:"#22c55e"},{name:"B (75-89%)",value:0,color:"#3b82f6"},{name:"C (60-74%)",value:0,color:"#eab308"},{name:"D (40-59%)",value:0,color:"#f97316"},{name:"F (0-39%)",value:0,color:"#ef4444"}];l.forEach(s=>{const a=s.marks/s.total_marks*100;a>=90?n[0].value++:a>=75?n[1].value++:a>=60?n[2].value++:a>=40?n[3].value++:n[4].value++});const C=y.map(s=>{const a=l.filter(r=>r.subject===s),t=a.length>0?Math.round(a.reduce((r,c)=>r+c.marks/c.total_marks*100,0)/a.length):0;return{name:s,score:t,fill:`hsl(${Math.random()*360}, 70%, 60%)`}}),_=l.filter(s=>{var o,f;const a=b.find(te=>te.id===s.student_id),t=((o=a==null?void 0:a.full_name)==null?void 0:o.toLowerCase().includes(S.toLowerCase()))||!1,r=p==="all"||s.subject===p,c=N==="all"||((f=a==null?void 0:a.class)==null?void 0:f.toString())===N;return t&&r&&c}).sort((s,a)=>{if(T==="date"){const t=new Date(s.test_date).getTime(),r=new Date(a.test_date).getTime();return v==="asc"?t-r:r-t}else{const t=s.marks/s.total_marks*100,r=a.marks/a.total_marks*100;return v==="asc"?t-r:r-t}}),A=s=>{T===s?w(v==="asc"?"desc":"asc"):(Y(s),w("desc"))},D=(s,a)=>{const t=s/a*100;return t>=90?{grade:"A",color:"bg-emerald-500"}:t>=75?{grade:"B",color:"bg-blue-500"}:t>=60?{grade:"C",color:"bg-yellow-500"}:t>=40?{grade:"D",color:"bg-orange-500"}:{grade:"F",color:"bg-red-500"}};return Z||ee?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh]",children:[e.jsx(he,{className:"h-10 w-10 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading test records..."})]}):e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"space-y-6",children:[e.jsx(xe,{title:"Test Records",description:"Track and manage student performance",showBackButton:!0,action:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{className:"bg-green-500 hover:bg-green-600",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"})," Add Test"]}),e.jsxs(B,{variant:"outline",children:[e.jsx(je,{className:"h-4 w-4 mr-2"})," Export"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(i,{className:"glass-card",children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-lg",children:"Total Tests"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:se}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Across all subjects and classes"})]})]}),e.jsxs(i,{className:"glass-card",children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-lg",children:"Average Score"})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-3xl font-semibold",children:[ae,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Overall student performance"})]})]}),e.jsxs(i,{className:"glass-card",children:[e.jsx(u,{className:"pb-2",children:e.jsx(j,{className:"text-lg",children:"Subjects"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:y.length}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Different subjects tested"})]})]})]}),e.jsxs(ce,{defaultValue:"tests",className:"space-y-4",children:[e.jsxs(ne,{children:[e.jsx(P,{value:"tests",children:"Test Records"}),e.jsx(P,{value:"analytics",children:"Performance Analytics"})]}),e.jsxs(F,{value:"tests",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Search student name...",value:S,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{value:p,onValueChange:J,children:[e.jsx($,{className:"w-[150px]",children:e.jsx(G,{placeholder:"Subject"})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"All Subjects"}),y.map(s=>e.jsx(g,{value:s,children:s},s))]})]}),e.jsxs(E,{value:N,onValueChange:X,children:[e.jsx($,{className:"w-[130px]",children:e.jsx(G,{placeholder:"Class"})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"All Classes"}),Array.from({length:9},(s,a)=>a+2).map(s=>e.jsxs(g,{value:s.toString(),children:["Class ",s]},s))]})]})]})]}),e.jsx("div",{className:"space-y-4",children:W?e.jsx(q,{children:_.map((s,a)=>{const t=b.find(o=>o.id===s.student_id),{grade:r,color:c}=D(s.marks,s.total_marks);return e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.05},children:e.jsx(i,{className:"overflow-hidden",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(t==null?void 0:t.full_name)||"Unknown Student"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Class ",(t==null?void 0:t.class)||"N/A"]})]}),e.jsx(Q,{className:c,children:r})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Subject"}),e.jsx("p",{children:s.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Date"}),e.jsx("p",{children:O(new Date(s.test_date),"dd MMM yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Test Name"}),e.jsx("p",{children:s.test_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Score"}),e.jsxs("p",{className:"font-medium",children:[s.marks,"/",s.total_marks," (",Math.round(s.marks/s.total_marks*100),"%)"]})]})]})]})})},s.id)})}):e.jsx(i,{children:e.jsx("div",{className:"rounded-md overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(oe,{children:e.jsxs(L,{children:[e.jsx(x,{children:"Student"}),e.jsx(x,{children:"Subject"}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>A("date"),children:["Date ",e.jsx(K,{className:"ml-2 h-3 w-3"})]})}),e.jsx(x,{children:"Test Name"}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>A("marks"),children:["Score ",e.jsx(K,{className:"ml-2 h-3 w-3"})]})}),e.jsx(x,{children:"Grade"})]})}),e.jsxs(me,{children:[e.jsx(q,{children:_.map((s,a)=>{const t=b.find(f=>f.id===s.student_id),{grade:r,color:c}=D(s.marks,s.total_marks),o=Math.round(s.marks/s.total_marks*100);return e.jsxs(k.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,delay:a*.02},children:[e.jsxs(d,{children:[e.jsx("div",{className:"font-medium",children:(t==null?void 0:t.full_name)||"Unknown"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Class ",(t==null?void 0:t.class)||"N/A"]})]}),e.jsx(d,{children:s.subject}),e.jsx(d,{children:O(new Date(s.test_date),"dd MMM yyyy")}),e.jsx(d,{children:s.test_name}),e.jsxs(d,{children:[e.jsxs("div",{className:"font-medium",children:[s.marks,"/",s.total_marks]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[o,"%"]})]}),e.jsx(d,{children:e.jsx(Q,{className:c,children:r})})]},s.id)})}),_.length===0&&e.jsx(L,{children:e.jsx(d,{colSpan:6,className:"h-24 text-center",children:"No test records found matching your search criteria"})})]})]})})})})]}),e.jsx(F,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{className:"overflow-hidden",children:[e.jsxs(u,{children:[e.jsx(j,{children:"Grade Distribution"}),e.jsx(R,{children:"Distribution of grades across all tests"})]}),e.jsx(m,{className:"p-0 h-[300px]",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ge,{children:[e.jsx(pe,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:s,percent:a})=>`${s} (${(a*100).toFixed(0)}%)`,children:n.map((s,a)=>e.jsx(V,{fill:s.color},`cell-${a}`))}),e.jsx(z,{formatter:s=>[`${s} tests`,"Count"]})]})})})]}),e.jsxs(i,{className:"overflow-hidden",children:[e.jsxs(u,{children:[e.jsx(j,{children:"Subject Performance"}),e.jsx(R,{children:"Average scores by subject"})]}),e.jsx(m,{className:"p-0 h-[300px]",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Ne,{data:C,layout:"vertical",children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(be,{type:"number",domain:[0,100]}),e.jsx(ye,{dataKey:"name",type:"category",width:100}),e.jsx(z,{formatter:s=>[`${s}%`,"Average Score"]}),e.jsx(_e,{dataKey:"score",radius:[0,4,4,0],children:C.map((s,a)=>e.jsx(V,{fill:s.fill},`cell-${a}`))})]})})})]})]})})]})]})}export{Ge as default};
