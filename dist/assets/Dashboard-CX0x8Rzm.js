import{j as e,b as P,c as z,d as ae,e as B,I as U,f as O,g as E,h as $,L as q,i as G,k as te,l as ie}from"./ui-core-DSsgHKQi.js";import{r as o,u as K}from"./react-core-C2Lho-Ro.js";import{u as _}from"./form-DucUJAz-.js";import{c as m,u as H,a as ne,B as g,s as F}from"./index-CwoeutiG.js";import{C as b,a as y,b as w,d as v,c as D}from"./card-D01js5Yw.js";import{T as le,a as re,b as k,c as p,d as oe,e as h}from"./table-KyucOfjK.js";import{A as de,a as ce}from"./avatar-BWfvur6U.js";import{h as V,i as me,j as xe,k as he,S as ue,b as pe,U as fe,G as je,C as ge,T as Ne,g as M}from"./utils-D1Dv2Yo8.js";import{m as f}from"./animation-CC1ogdXw.js";import{R as be,B as ye,C as we,X as ve,Y as Ce,T as Se,a as Te}from"./data-viz-DCuZCixt.js";import"./auth-D43A8yQe.js";function N({title:a,value:i,icon:t,description:n,className:x,trend:d}){return e.jsxs(b,{className:m("glass-card overflow-hidden",x),children:[e.jsxs(y,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(w,{className:"text-sm font-medium text-muted-foreground",children:a}),e.jsx("div",{className:"p-2 bg-primary/10 text-primary rounded-full",children:t})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),n&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n}),d&&e.jsxs("div",{className:m("flex items-center mt-2 text-xs",d.isPositive?"text-apple-green":"text-apple-red"),children:[d.isPositive?"↑":"↓"," ",Math.abs(d.value),"%",e.jsx("span",{className:"ml-1 text-muted-foreground",children:"from last month"})]})]})]})}const Ae=te,De=ie,ke=o.forwardRef(({className:a,inset:i,children:t,...n},x)=>e.jsxs(P,{ref:x,className:m("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",i&&"pl-8",a),...n,children:[t,e.jsx(V,{className:"ml-auto h-4 w-4"})]}));ke.displayName=P.displayName;const Ie=o.forwardRef(({className:a,...i},t)=>e.jsx(z,{ref:t,className:m("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i}));Ie.displayName=z.displayName;const X=o.forwardRef(({className:a,sideOffset:i=4,...t},n)=>e.jsx(ae,{children:e.jsx(B,{ref:n,sideOffset:i,className:m("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));X.displayName=B.displayName;const C=o.forwardRef(({className:a,inset:i,...t},n)=>e.jsx(U,{ref:n,className:m("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i&&"pl-8",a),...t}));C.displayName=U.displayName;const Le=o.forwardRef(({className:a,children:i,checked:t,...n},x)=>e.jsxs(O,{ref:x,className:m("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(E,{children:e.jsx(me,{className:"h-4 w-4"})})}),i]}));Le.displayName=O.displayName;const Re=o.forwardRef(({className:a,children:i,...t},n)=>e.jsxs($,{ref:n,className:m("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(E,{children:e.jsx(xe,{className:"h-2 w-2 fill-current"})})}),i]}));Re.displayName=$.displayName;const Y=o.forwardRef(({className:a,inset:i,...t},n)=>e.jsx(q,{ref:n,className:m("px-2 py-1.5 text-sm font-semibold",i&&"pl-8",a),...t}));Y.displayName=q.displayName;const I=o.forwardRef(({className:a,...i},t)=>e.jsx(G,{ref:t,className:m("-mx-1 my-1 h-px bg-muted",a),...i}));I.displayName=G.displayName;function _e({username:a,imageUrl:i}){const t=K(),{logout:n}=H(),[x,d]=o.useState(!1),S=a?a.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2):"U",u=async()=>{await n()};return e.jsxs(Ae,{open:x,onOpenChange:d,children:[e.jsx(De,{asChild:!0,className:"cursor-pointer",children:e.jsx(de,{className:"h-9 w-9 bg-primary/10 hover:bg-primary/20 transition-colors border border-border/50",children:i?e.jsx("img",{src:i,alt:a||"User",className:"object-cover"}):e.jsx(ce,{className:"bg-primary/10 text-primary text-sm font-medium",children:S})})}),e.jsxs(X,{align:"end",className:"w-56",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:a||"User"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:"Admin"})]})}),e.jsx(I,{}),e.jsxs(C,{onClick:()=>t("/profile"),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Profile"]}),e.jsxs(C,{onClick:()=>t("/settings"),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Settings"]}),e.jsx(I,{}),e.jsxs(C,{onClick:u,className:"text-destructive focus:text-destructive",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})}function Ke(){var R;const{user:a,logout:i}=H(),t=K(),[n,x]=o.useState([]),[d,S]=o.useState([]),u=ne(),{data:c=[],isLoading:T}=_({queryKey:["students"],queryFn:async()=>{const{data:s,error:r}=await F.from("students").select("*");if(r)throw r;return s||[]}});_({queryKey:["fee_transactions"],queryFn:async()=>{const{data:s,error:r}=await F.from("fee_transactions").select("*");if(r)throw r;return s||[]}}),o.useEffect(()=>{if(c.length>0){const s={};c.forEach(l=>{s[l.class]||(s[l.class]=0),s[l.class]++});const r=Object.keys(s).map(l=>({class:`Class ${l}`,count:s[parseInt(l)]})).sort((l,A)=>{const ee=parseInt(l.class.split(" ")[1]),se=parseInt(A.class.split(" ")[1]);return ee-se});x(r);const Z=c.filter(l=>l.fee_status!=="Paid").map(l=>({...l,outstandingAmount:l.total_fees-l.paid_fees})).sort((l,A)=>A.outstandingAmount-l.outstandingAmount);S(Z)}},[c]);const J=[...c].sort((s,r)=>new Date(r.join_date).getTime()-new Date(s.join_date).getTime()).slice(0,5),Q=c.reduce((s,r)=>s+(r.total_fees||0),0),L=c.reduce((s,r)=>s+(r.paid_fees||0),0),W={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},j={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return e.jsxs(f.div,{variants:W,initial:"hidden",animate:"show",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f.div,{variants:j,className:"flex flex-col",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight infinity-title",children:"Infinity Classes"}),e.jsx("p",{className:"text-muted-foreground",children:"Learn till eternity, with dignity in Infinity."})]}),e.jsx(_e,{username:((R=a==null?void 0:a.email)==null?void 0:R.split("@")[0])||"Admin"})]}),e.jsxs(f.div,{variants:j,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Total Students",value:c.length.toString(),icon:e.jsx(fe,{className:"h-4 w-4"}),description:"All registered students",trend:{value:3,isPositive:!0}}),e.jsx(N,{title:"Total Classes",value:n.length.toString(),icon:e.jsx(je,{className:"h-4 w-4"}),description:"Classes 2-10"}),e.jsx(N,{title:"Fee Collection",value:`₹${L.toLocaleString()}`,icon:e.jsx(ge,{className:"h-4 w-4"}),description:"Total collected fees",trend:{value:12,isPositive:!0}}),e.jsx(N,{title:"Pending Fees",value:`₹${(Q-L).toLocaleString()}`,icon:e.jsx(Ne,{className:"h-4 w-4"}),description:"Total outstanding fees",trend:d.length>0?{value:d.length,isPositive:!1}:void 0})]}),e.jsxs(f.div,{variants:j,className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(b,{className:"glass-card lg:col-span-2",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Class Distribution"}),e.jsx(D,{children:"Number of students in each class"})]}),e.jsx(v,{className:"pl-2",children:e.jsx("div",{className:"h-[300px] w-full overflow-x-hidden",children:T?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{children:"Loading chart data..."})}):e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(ye,{data:n,margin:u?{top:5,right:10,left:0,bottom:5}:{top:20,right:30,left:20,bottom:5},children:[e.jsx(we,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"class",fontSize:u?10:12,tick:{fill:"#888"},interval:u?1:0}),e.jsx(Ce,{allowDecimals:!1,fontSize:u?10:12,width:u?25:40}),e.jsx(Se,{}),e.jsx(Te,{dataKey:"count",name:"Students",fill:"#0A84FF",radius:[4,4,0,0]})]})})})})]}),e.jsxs(b,{className:"glass-card",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Recent Admissions"}),e.jsx(D,{children:"Newly joined students"})]}),e.jsx(v,{children:T?e.jsx("div",{className:"h-[220px] flex items-center justify-center",children:e.jsx("p",{children:"Loading recent admissions..."})}):e.jsxs("div",{className:"space-y-4",children:[J.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Class ",s.class]})]}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>t(`/students/${s.id}`),children:e.jsx(M,{className:"h-4 w-4"})})]},s.id)),e.jsxs(g,{variant:"ghost",className:"w-full mt-2",onClick:()=>t("/students"),children:["View All Students ",e.jsx(V,{className:"ml-2 h-4 w-4"})]})]})})]})]}),e.jsx(f.div,{variants:j,children:e.jsxs(b,{className:"glass-card",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Pending Fees"}),e.jsx(D,{children:"Students with outstanding payments (sorted by amount)"})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>t("/fees"),children:"View All"})]}),e.jsx(v,{children:T?e.jsx("div",{className:"h-[220px] flex items-center justify-center",children:e.jsx("p",{children:"Loading pending fees data..."})}):e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(re,{children:e.jsxs(k,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{className:"hidden md:table-cell",children:"Class"}),e.jsx(p,{className:"hidden sm:table-cell",children:"Guardian"}),e.jsx(p,{className:"text-right",children:"Paid"}),e.jsx(p,{className:"text-right",children:"Total"}),e.jsx(p,{className:"text-right",children:"Outstanding"}),e.jsx(p,{})]})}),e.jsxs(oe,{children:[d.slice(0,5).map(s=>e.jsxs(k,{children:[e.jsx(h,{className:"font-medium",children:s.full_name}),e.jsxs(h,{className:"hidden md:table-cell",children:["Class ",s.class]}),e.jsx(h,{className:"hidden sm:table-cell",children:s.guardian_name}),e.jsxs(h,{className:"text-right",children:["₹",s.paid_fees.toLocaleString()]}),e.jsxs(h,{className:"text-right",children:["₹",s.total_fees.toLocaleString()]}),e.jsxs(h,{className:"text-right text-apple-red",children:["₹",s.outstandingAmount.toLocaleString()]}),e.jsx(h,{children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>t(`/students/${s.id}`),children:e.jsx(M,{className:"h-4 w-4"})})})]},s.id)),d.length===0&&e.jsx(k,{children:e.jsx(h,{colSpan:7,className:"text-center py-4",children:"No pending fees"})})]})]})})})]})})]})}export{Ke as default};
